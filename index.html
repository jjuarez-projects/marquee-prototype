<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>School Marquee Manager Prototype</title>
<style>
  body { font-family: sans-serif; }
  section { margin-bottom: 2em; }
  ul { list-style-type: none; padding-left: 0; }
  li { margin-bottom: 0.5em; }
  input[type="text"], input[type="date"] { width: 200px; }
  li[draggable="true"] {
  cursor: grab;
  padding: 4px;
  border: 1px solid #ccc;
  margin: 2px 0;
  background: #f9f9f9;
}

li[draggable="true"]:active {
  cursor: grabbing;
  background: #e0e0e0;
}
</style>
</head>
<body>
  <h1>School Marquee Manager Prototype</h1>

  <!-- Draft Creation -->
  <section>
    <h2>Create Message Draft</h2>
    <label>Line 1: <input type="text" id="line1"></label><br>
    <label>Line 2: <input type="text" id="line2"></label><br>
    <label>Line 3: <input type="text" id="line3"></label><br>
    <label>Line 4: <input type="text" id="line4"></label><br>
    <button id="saveDraftBtn">Save Draft</button>
    <button id="submitPendingBtn">Submit for Approval</button>
  </section>

  <!-- Lists -->
  <section>
    <h2>Drafts</h2>
    <ul id="draftList"></ul>
  </section>

  <section>
    <h2>Pending Approvals</h2>
    <ul id="pendingList"></ul>
  </section>

  <section>
    <h2>Approved / Scheduled</h2>
    <ul id="approvedList"></ul>
  </section>

  <section>
    <h2>Prep Sheet (Today’s Work)</h2>
    <ul id="prepSheet"></ul>
  </section>

<script>
let messages = [];
let nextId = 1;

// Utility: today's date in yyyy-mm-dd for comparison
function todayStr() {
  const d = new Date();
  return d.toISOString().split('T')[0];
}

// Render all lists
function render() {
  const draftList = document.getElementById("draftList");
  const pendingList = document.getElementById("pendingList");
  const approvedList = document.getElementById("approvedList");
  const prepSheet = document.getElementById("prepSheet");

  // Clear all lists first
  draftList.innerHTML = "";
  pendingList.innerHTML = "";
  approvedList.innerHTML = "";
  prepSheet.innerHTML = "";

  const today = todayStr();

  messages.forEach(msg => {
    const content = msg.lines.filter(l => l).join(" | ");

    // DRAFTS
    if (msg.status === "draft") {
      const li = document.createElement("li");
      li.textContent = content;
      const submitBtn = document.createElement("button");
      submitBtn.textContent = "Submit for Approval";
      submitBtn.onclick = () => { msg.status = "pending"; render(); };
      const delBtn = document.createElement("button");
      delBtn.textContent = "Delete";
      delBtn.onclick = () => { messages = messages.filter(m => m.id !== msg.id); render(); };
      li.appendChild(document.createTextNode(" "));
      li.appendChild(submitBtn);
      li.appendChild(document.createTextNode(" "));
      li.appendChild(delBtn);
      draftList.appendChild(li);
    }

    // PENDING
    if (msg.status === "pending") {
      const li = document.createElement("li");
      li.textContent = content + " [Pending] ";

      const startInput = document.createElement("input");
      startInput.type = "date";
      startInput.value = msg.startDate || today;
      const endInput = document.createElement("input");
      endInput.type = "date";
      endInput.value = msg.endDate || today;

      const approveBtn = document.createElement("button");
      approveBtn.textContent = "Approve";
      approveBtn.onclick = () => {
        msg.startDate = startInput.value;
        msg.endDate = endInput.value;
        msg.status = "approved";
        render();
      };

      const rejectBtn = document.createElement("button");
      rejectBtn.textContent = "Reject";
      rejectBtn.onclick = () => { msg.status = "draft"; render(); };

      li.appendChild(document.createTextNode(" Start: "));
      li.appendChild(startInput);
      li.appendChild(document.createTextNode(" End: "));
      li.appendChild(endInput);
      li.appendChild(document.createTextNode(" "));
      li.appendChild(approveBtn);
      li.appendChild(document.createTextNode(" "));
      li.appendChild(rejectBtn);
      pendingList.appendChild(li);
    }

    // APPROVED
    if (msg.status === "approved") {
      const li = document.createElement("li");

      const lineList = document.createElement("ul");
      lineList.style.listStyleType = "none";
      lineList.style.paddingLeft = "0";

      msg.lines.forEach((lineText, idx) => {
        if (!lineText) return; // skip empty lines

        const lineLi = document.createElement("li");
        lineLi.textContent = lineText;
        lineLi.draggable = true;
        lineLi.dataset.index = idx;

        // Drag events
        lineLi.addEventListener("dragstart", (e) => {
          e.dataTransfer.setData("text/plain", idx);
        });
        lineLi.addEventListener("dragover", (e) => {
          e.preventDefault();
        });
        lineLi.addEventListener("drop", (e) => {
          e.preventDefault();
          const fromIdx = parseInt(e.dataTransfer.getData("text/plain"));
          const toIdx = idx;
          // Swap lines
          const temp = msg.lines[fromIdx];
          msg.lines[fromIdx] = msg.lines[toIdx];
          msg.lines[toIdx] = temp;
          render();
        });

        lineList.appendChild(lineLi);
      });

      li.appendChild(lineList);

      // Add start/end date inputs + update button (existing)
      const startInput = document.createElement("input");
      startInput.type = "date";
      startInput.value = msg.startDate;
      const endInput = document.createElement("input");
      endInput.type = "date";
      endInput.value = msg.endDate;

      const updateBtn = document.createElement("button");
      updateBtn.textContent = "Update Dates";
      updateBtn.onclick = () => {
        msg.startDate = startInput.value;
        msg.endDate = endInput.value;
        render();
      };

      li.appendChild(document.createTextNode(" Start: "));
      li.appendChild(startInput);
      li.appendChild(document.createTextNode(" End: "));
      li.appendChild(endInput);
      li.appendChild(document.createTextNode(" "));
      li.appendChild(updateBtn);

      approvedList.appendChild(li);

      // Prep sheet (unchanged)
      const prepLi = document.createElement("li");
      prepLi.textContent = msg.lines.filter(l => l).join(" | ") +
                          ` (Active: ${msg.startDate} – ${msg.endDate})`;

      if (msg.startDate === today) {
        prepLi.style.backgroundColor = "#d4edda";
        prepLi.style.fontWeight = "bold";
        prepLi.textContent += " → ADD";
      }
      if (msg.endDate === today) {
        prepLi.style.backgroundColor = "#f8d7da";
        prepLi.style.fontWeight = "bold";
        prepLi.textContent += " → REMOVE";
      }
      if (today > msg.startDate && today < msg.endDate) {
        prepLi.style.backgroundColor = "#fff3cd";
      }

      prepSheet.appendChild(prepLi);
    }
  });
}

// Create a message object
function createMessage(status) {
  const lines = [
    document.getElementById("line1").value.trim(),
    document.getElementById("line2").value.trim(),
    document.getElementById("line3").value.trim(),
    document.getElementById("line4").value.trim()
  ];
  messages.push({
    id: nextId++,
    lines,
    status,
    startDate: null,
    endDate: null
  });
  document.getElementById("line1").value = "";
  document.getElementById("line2").value = "";
  document.getElementById("line3").value = "";
  document.getElementById("line4").value = "";
  render();
}

document.getElementById("saveDraftBtn").addEventListener("click", () => createMessage("draft"));
document.getElementById("submitPendingBtn").addEventListener("click", () => createMessage("pending"));

render();
</script>
</body>
</html>
