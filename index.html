<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>School Marquee Manager</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 0;
    }
    header {
      background: #004080;
      color: white;
      padding: 1rem;
      text-align: center;
    }
    main {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      padding: 1rem;
    }
    section {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h2 {
      margin-top: 0;
    }
    .marquee-board {
      background: black;
      color: lime;
      font-family: monospace;
      padding: 1rem;
      border-radius: 8px;
      min-height: 120px;
    }
    .marquee-board div {
      height: 1.5em;
    }
    .line {
      border-bottom: 1px dashed #ccc;
      margin-bottom: 0.5rem;
      padding-bottom: 0.5rem;
      cursor: pointer;
    }
    .line:hover {
      background: #f0f8ff;
    }
    .prep-list ul {
      list-style: none;
      padding: 0;
    }
    .prep-list li {
      margin: 0.25rem 0;
      padding: 0.25rem 0.5rem;
      background: #eee;
      border-radius: 4px;
    }
    .message-form input[type=text] {
      width: 100%;
      margin-bottom: 0.5rem;
      padding: 0.4rem;
    }
    button {
      background: #004080;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #0066cc;
    }
  </style>
</head>
<body>
  <header>
    <h1>School Marquee Manager</h1>
  </header>
  <main>
    <!-- Current marquee -->
    <section>
      <h2>Currently Displayed</h2>
      <div class="marquee-board" id="current-board">
        <div>Welcome Back Students</div>
        <div>Go Wildcats!</div>
        <div>Homecoming 9/20</div>
        <div>Early Dismissal Fri</div>
      </div>
    </section>

    <!-- New message planner -->
    <section>
      <h2>Plan a Message</h2>
      <form class="message-form" id="message-form">
        <input type="text" placeholder="Line 1" name="line1">
        <input type="text" placeholder="Line 2" name="line2">
        <input type="text" placeholder="Line 3" name="line3">
        <input type="text" placeholder="Line 4" name="line4">
        <button type="submit">Schedule Message</button>
      </form>
    </section>

    <!-- Schedule view -->
    <section>
      <h2>Scheduled Messages</h2>
      <div id="scheduled-list"></div>
    </section>

    <!-- Prep sheet -->
    <section class="prep-list">
      <h2>Prep Sheet (Next Change)</h2>
      <ul id="prep-sheet"></ul>
    </section>
  </main>

  <script>
document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('message-form');
  const scheduledList = document.getElementById('scheduled-list');
  const currentBoard = document.getElementById('current-board');
  const prepSheet = document.getElementById('prep-sheet');

  // Ensure the current board has 4 lines (so we always have a predictable structure)
  function ensureBoardLines() {
    if (currentBoard.children.length === 0) {
      for (let i = 0; i < 4; i++) {
        const d = document.createElement('div');
        d.textContent = '';
        currentBoard.appendChild(d);
      }
    } else if (currentBoard.children.length < 4) {
      for (let i = currentBoard.children.length; i < 4; i++) {
        const d = document.createElement('div');
        d.textContent = '';
        currentBoard.appendChild(d);
      }
    }
  }
  ensureBoardLines();

  let scheduledMessages = [];

  // Submit new message (keeps same form IDs / names you already have)
  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const data = new FormData(form);
    const newMessage = [
      data.get('line1') || '',
      data.get('line2') || '',
      data.get('line3') || '',
      data.get('line4') || ''
    ].filter(l => l.trim() !== '');

    if (newMessage.length === 0) return;

    scheduledMessages.push(newMessage);
    renderSchedule();

    // Show prep sheet comparing the CURRENT BOARD -> the newly added message
    const currentLines = Array.from(currentBoard.children).map(d => d.textContent || '');
    generatePrepFromBoards(currentLines, newMessage);

    form.reset();
  });

  // Render the scheduled messages list
  function renderSchedule() {
    scheduledList.innerHTML = '';
    scheduledMessages.forEach((msg, idx) => {
      const container = document.createElement('div');
      container.className = 'line';

      const text = document.createElement('div');
      text.textContent = `Message ${idx + 1}: ${msg.join(' | ')}`;
      container.appendChild(text);

      const applyBtn = document.createElement('button');
      applyBtn.textContent = 'Apply';
      applyBtn.style.marginLeft = '8px';
      applyBtn.addEventListener('click', () => applyMessage(idx));
      container.appendChild(applyBtn);

      const del = document.createElement('button');
      del.textContent = 'Delete';
      del.style.marginLeft = '6px';
      del.style.background = '#cc0000';
      del.addEventListener('click', (ev) => {
        ev.stopPropagation();
        scheduledMessages.splice(idx, 1);
        renderSchedule();
        prepSheet.innerHTML = ''; // clear prep sheet on delete to avoid confusion
      });
      container.appendChild(del);

      scheduledList.appendChild(container);
    });
  }

  // Build counts from an array of lines (removes whitespace)
  function charCountsFromLines(lines) {
    const counts = {};
    const joined = Array.isArray(lines) ? lines.join('') : String(lines);
    const normalized = joined.toUpperCase().replace(/\s+/g, '');
    for (const ch of normalized) {
      counts[ch] = (counts[ch] || 0) + 1;
    }
    return counts;
  }

  // Render counts into compact text
  function renderCountsMap(map) {
    if (!map || Object.keys(map).length === 0) return '(none)';
    const parts = [];
    const keys = Object.keys(map).sort();
    for (const k of keys) parts.push(`${k}: ${map[k]}`);
    return parts.join('   ');
  }

  // Generate the prep sheet given old (current) lines and new message lines
  function generatePrepFromBoards(oldLines, newLines) {
    prepSheet.innerHTML = '';

    // REMOVE section (what to take down)
    const removeHeader = document.createElement('li');
    removeHeader.textContent = 'REMOVE (take down these letters)';
    removeHeader.style.fontWeight = 'bold';
    prepSheet.appendChild(removeHeader);

    const remText = document.createElement('li');
    remText.textContent = oldLines.join(' | ');
    prepSheet.appendChild(remText);

    const remCounts = charCountsFromLines(oldLines);
    const remCountsLi = document.createElement('li');
    remCountsLi.textContent = renderCountsMap(remCounts);
    prepSheet.appendChild(remCountsLi);

    // ADD section (what to put up)
    const addHeader = document.createElement('li');
    addHeader.textContent = 'ADD (put up these letters)';
    addHeader.style.fontWeight = 'bold';
    prepSheet.appendChild(addHeader);

    const addText = document.createElement('li');
    addText.textContent = newLines.join(' | ');
    prepSheet.appendChild(addText);

    const addCounts = charCountsFromLines(newLines);
    const addCountsLi = document.createElement('li');
    addCountsLi.textContent = renderCountsMap(addCounts);
    prepSheet.appendChild(addCountsLi);
  }

  // Apply a scheduled message to the current board (shows prep BEFORE applying)
  function applyMessage(index) {
    const newMsg = scheduledMessages[index];
    const oldLines = Array.from(currentBoard.children).map(d => d.textContent || '');

    // Show the prep (REMOVE oldLines -> ADD newMsg) BEFORE changing the board
    generatePrepFromBoards(oldLines, newMsg);

    // Update the visible board
    currentBoard.innerHTML = '';
    for (let i = 0; i < 4; i++) {
      const d = document.createElement('div');
      d.textContent = newMsg[i] || '';
      currentBoard.appendChild(d);
    }

    // Simulate rotation: remove the applied message from schedule
    scheduledMessages.splice(index, 1);
    renderSchedule();
  }

  // initial render (if you had seeded scheduledMessages in code, render them)
  renderSchedule();
});
</script>
</body>
</html>